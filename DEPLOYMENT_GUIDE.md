# CSE 340 Project - Deployment and Testing Guide

## ðŸš€ Deployment on Render

### 1. Render Configuration
Your project now includes a `render.yaml` file that deploys both the web application and PostgreSQL database in a single instance.

### 2. Environment Variables
The following environment variables are configured in your `.env` file:

```env
# Database Configuration (will be overridden by Render)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=cse340db
DB_USER=postgres
DB_PASSWORD=password

# Session Configuration (auto-generated by Render)
SESSION_SECRET=your-secret-key-here-make-this-long-and-random-for-production

# JWT Configuration (auto-generated by Render)
JWT_SECRET=your-jwt-secret-key-here-make-this-long-and-random-for-production

# Server Configuration
PORT=5500
HOST=localhost

# Node Environment
NODE_ENV=development
```

### 3. Deployment Steps

1. **Commit your changes to GitHub:**
   ```bash
   git add .
   git commit -m "Fix Assignment 5 implementation and add Render deployment config"
   git push origin main
   ```

2. **Deploy on Render:**
   - Go to [render.com](https://render.com)
   - Click "New +" -> "Blueprint"
   - Connect your GitHub repository
   - Select the `render.yaml` file when prompted
   - Deploy the service

3. **Database Setup:**
   - Render will automatically provision a PostgreSQL database
   - The database schema will need to be created (see Database Schema section below)

## ðŸ§ª Testing Instructions

### 1. Local Development Testing

1. **Start the application:**
   ```bash
   npm start
   ```

2. **Test Authentication Flow:**
   - Navigate to `http://localhost:5500`
   - Click "My Account" to register a new account
   - Register with email/password (password must be 8+ chars with uppercase, lowercase, number)
   - Verify you're redirected to account management page
   - Check that header shows "Welcome [Name]" and "Logout" links
   - Test logout functionality

3. **Test Account Management:**
   - Click "Update Account Information" link
   - Update first name, last name, or email
   - Verify changes are saved and reflected in management page
   - Test password change functionality

4. **Test Inventory Management (Employee/Admin only):**
   - Register a new account or update existing to "Employee" or "Admin" type
   - Navigate to inventory management (`/inv/`)
   - Add new classifications and vehicles
   - Verify authorization works correctly

### 2. Production Testing

1. **Access your deployed application:**
   - Use the Render URL provided after deployment
   - Test all authentication and authorization flows
   - Verify database persistence across deployments

2. **Database Connection Testing:**
   - The app should connect to Render's PostgreSQL automatically
   - All user accounts and inventory data should persist

## ðŸ“‹ Assignment 5 Features Implemented

### âœ… Task 1: Header Partial Updates
- Login state properly shows/hides "My Account" and "Logout" links
- "Welcome [Name]" link appears when logged in
- Links are completely hidden from source code when not applicable

### âœ… Task 2: JWT Middleware Authorization
- `requireEmployeeOrAdmin` middleware protects inventory routes
- Unauthorized users redirected to login with appropriate message
- Public inventory views remain accessible to all users

### âœ… Task 3: Account Management View
- Proper greeting based on account type (Client vs Employee/Admin)
- Inventory Management link shown only for Employee/Admin accounts
- "Update Account Information" link visible to all authenticated users

### âœ… Task 4: Account Update View
- Two separate forms: Account Update and Change Password
- Proper form validation and error handling
- Sticky form inputs on validation errors
- Password requirements clearly displayed

### âœ… Task 5: Update Route Handlers
- Server-side validation for all update operations
- Email uniqueness checking (excluding current account)
- JWT token refresh after account updates
- Proper error handling and user feedback

### âœ… Task 6: Logout Process
- JWT cookie properly cleared
- User redirected to home page
- Complete session termination

## ðŸ”§ Database Schema

If you need to recreate the database on Render, run these SQL commands:

```sql
-- Account table
CREATE TABLE account (
    account_id SERIAL PRIMARY KEY,
    account_firstname VARCHAR(50) NOT NULL,
    account_lastname VARCHAR(50) NOT NULL,
    account_email VARCHAR(100) NOT NULL UNIQUE,
    account_password VARCHAR(255) NOT NULL,
    account_type VARCHAR(20) NOT NULL DEFAULT 'Client'
);

-- Classification table
CREATE TABLE classification (
    classification_id SERIAL PRIMARY KEY,
    classification_name VARCHAR(50) NOT NULL UNIQUE
);

-- Inventory table
CREATE TABLE inventory (
    inv_id SERIAL PRIMARY KEY,
    inv_make VARCHAR(50) NOT NULL,
    inv_model VARCHAR(50) NOT NULL,
    inv_year INTEGER NOT NULL,
    inv_description TEXT,
    inv_image VARCHAR(255),
    inv_thumbnail VARCHAR(255),
    inv_price DECIMAL(10,2) NOT NULL,
    inv_miles INTEGER,
    inv_color VARCHAR(50),
    classification_id INTEGER REFERENCES classification(classification_id)
);

-- Insert sample data
INSERT INTO classification (classification_name) VALUES
('SUV'), ('Sedan'), ('Truck'), ('Coupe');

INSERT INTO account (account_firstname, account_lastname, account_email, account_password, account_type)
VALUES ('Test', 'User', 'test@example.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2uheWG/igi', 'Client');
```

## ðŸš¨ Important Notes

1. **Database Migration:** If you have existing data in your old Render database, you'll need to manually migrate it to the new consolidated instance.

2. **Environment Variables:** Render will automatically generate secure values for `JWT_SECRET` and `SESSION_SECRET`.

3. **HTTPS Only:** In production, JWT cookies are set with `secure: true` to work only over HTTPS.

4. **Error Handling:** All forms include proper client-side and server-side validation with user-friendly error messages.

## ðŸŽ¯ Next Steps

1. Deploy to Render using the provided configuration
2. Test all authentication and authorization flows
3. Verify database connectivity and data persistence
4. Submit both your GitHub repository URL and Render application URL for grading

## ðŸ“ž Support

If you encounter any issues:
1. Check the Render logs for error messages
2. Verify database connectivity with the provided connection string
3. Ensure all environment variables are properly set
4. Test locally first before deploying to production
